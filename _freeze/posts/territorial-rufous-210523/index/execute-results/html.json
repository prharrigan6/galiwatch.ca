{
  "hash": "8aafd15a304ac4fb52b7ffc2d10bdda9",
  "result": {
    "markdown": "---\ntitle: Ter\ndraft: true\ndate: 2023-03-17\nauthor: Cait Harrigan\nimage: thumbnail.jpg\ntoc: true\ncategories:\n  - birds\n  - code\n  - data analysis\n  - deep-dive\nformat:\n  html:\n      code-fold: true\n---\n\n\nReading time: 3 minutes\n\n\n![](species_locations.gif)\n# Continuation of hummer-watch data analysis!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(patchwork)\nlibrary(ggpubr)\n\n#weather <- read_csv('https://github.com/teaswamp-creations/galiwatch.ca/raw/quarto-website/posts/hummer-watch/WS_hours.csv') %>%\nweather <- read_csv('WS_hours.csv') %>%\n  # retain only non-duplicates\n  distinct() %>%\n  # Clean up timestamps, convert to celsius\n  mutate(Date = ymd(Date), \n         MergeTime = ymd_hms(paste(Date, Time)),\n         `Temp C` = (`Outdoor Temperature F`-32) * (5/9)\n         )\n\n# classifier labels\nclasses = c('Rufous_Male', 'Annas_Male', 'Person', 'Annas_Female', 'Rufous_Female')\n\n# read in bird detection data, and do some basic data cleaning\n#bird <- read_csv('https://raw.githubusercontent.com/teaswamp-creations/galiwatch.ca/quarto-website/posts/hummer-watch/2021_reprocessed_hummers_combo_2023.csv') %>% \nbird <- read_csv('2021_reprocessed_hummers_combo_2023.csv') %>%\n  # lookup labels\n  mutate(class = classes[label + 1]) %>%\n  # put columns into tidy format\n  separate(class, into=c('Species', 'Sex'), sep='_') %>%\n  separate(image, into=c('Date', 'image'), sep=\"_\", remove = F) %>%\n  separate(image, into=c('hhmm'), sep=\".jpg\", extra = 'drop') %>%\n  # clean up timestamps\n  mutate(Timestamp = ymd_hm(paste(Date, hhmm))) %>%\n  # remove people\n  filter(label != 2) %>%\n  # change column types, correct for variable image size\n  mutate(Date=ymd(Date),\n         Month=factor(month(Date, label = T)),\n         Hour=hour(Timestamp),\n         Species = ordered(Species),\n         Sex = factor(Sex),\n         ymin2 = ymin,\n         ymin = (y_size - ymax),\n         ymax = (y_size - ymin2),\n         MergeTime = floor_date(Timestamp, 'hour')\n  ) %>%\n  # correct for variable image size\n  mutate(\n    ymin = ifelse(y_size == 420, ymin * (616/420), ymin),\n    ymax = ifelse(y_size == 420, ymax * (616/420), ymax),\n    xmin = ifelse(y_size == 420, xmin * (616/420), xmin),\n    xmax = ifelse(y_size == 420, xmax * (616/420), xmax),\n  )\n\n\nbird$batch <- 1\nbird$batch <- ifelse(bird$Timestamp > ymd_hms('2021-05-08 00:00:00'),2,bird$batch)\nbird$batch <- ifelse(bird$Timestamp > ymd_hms('2021-05-11 00:00:00'),3,bird$batch)\nbird$batch <- ifelse(bird$Timestamp > ymd_hms('2021-06-13 12:21:00'),4,bird$batch)                  \nbird$batch <- factor(bird$batch)\n\nbird_c <- bird %>% \n  mutate(Month = month(Date, label=T)) %>%\n  group_by(batch) %>%\n  mutate(across(c(xmin, xmax, ymin, ymax), ~ .x-mean(.x)) ) %>%\n  mutate(xmid = (xmax+xmin)/2, ymid = (ymax+ymin)/2)\n```\n:::\n\n\n\n# Number of birds in an image for each class\n\nRufous males can be very territorial. We'd like to know whether we can see evidence of the \"chasing away\" behaviour.\n\nIf this is the case, then the disappearance of the male rufous should lead to an increase in the *absolute number* of Annas who come (but might not affect the number of female rufous.  And the later disappearance of the female rufous should also lead to an increase in the number of Annas.\n\nBecause it's hard to see this on a minute-to-minute basis, we'll summarize the number of Anna visits by day.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# number of birds per day \n\nbird_c %>% \n  group_by(Date, Species, Sex) %>%\n  summarise(n=n(), `Temp C` = max(`Temp C`), .groups='keep') %>%\n  ggplot() + \n  aes(x = Date, y = n, fill = Sex) + \n  geom_bar(stat = 'identity') +\n  facet_wrap(~Species) + \n  labs(y = 'Number of bird visits', title = 'Most Rufous visit in Summer, Female Annas visit in Fall,\\nMale Annas are year-round')\n\n# Not really what happened\n\nbird_c %>% \n  group_by(Date, Species, Sex) %>%\n  summarise(n=n(), `Temp C` = max(`Temp C`), .groups='keep') %>%\n  ggplot() + \n  aes(x = n, y = `Temp C`, colour = Sex) + \n  geom_point() + \n  geom_smooth(method = 'lm', formula = 'y~x', se = F, linetype='dashed') +\n  facet_wrap(~Species, scales = 'free_x') + \n  labs(x = 'Number of bird visits', title = 'Everyone except Female Annas prefers lower temperatures')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# total number of birds per day\nbird %>%\n  filter(Species=='Annas') %>%\n  mutate('Rufous Males present' = Date < ymd('2021-07-31')) %>%\n  group_by(Date,`Rufous Males present`, Sex, .groups='keep') %>%\n  summarize(n=n()) %>%\n  ggplot(aes(x=`Rufous Males present`, y = n)) +\n  geom_rect(aes(fill = Sex),xmin = -Inf,xmax = Inf, ymin = -Inf,ymax = Inf, show.legend = F) + \n  geom_boxplot() + \n  facet_wrap(\"~Sex\") + \n  stat_compare_means(method = \"t.test\", label.y = 180, label.x = 1.3) + \n  geom_bracket(xmin = 1, xmax = 2, label = '', y.position = c(170)) +\n  theme_pubr() + \n  labs(title='Rufous Males are better at scaring off Female Annas than Male Annas') + \n  scale_fill_manual(values = c('chartreuse1', 'chartreuse4'))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'Date', 'Rufous Males present', 'Sex'. You\ncan override using the `.groups` argument.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# average number of birds per image per day\nbird %>%\n  filter(Species=='Annas') %>%\n  mutate('Rufous Males present' = Date < ymd('2021-07-31')) %>%\n  \n  group_by(Date,`Rufous Males present`, Timestamp, Sex, .groups='keep') %>%\n  summarize(n=n()) %>%\n  group_by(Date, `Rufous Males present`, Sex) %>%\n  summarize(n=mean(n), .groups = 'keep') %>%\n  \n  ggplot(aes(x=`Rufous Males present`, y = n)) +\n  geom_rect(aes(fill = Sex),xmin = -Inf,xmax = Inf, ymin = -Inf,ymax = Inf, show.legend = F) + \n  geom_boxplot() + \n  facet_wrap(\"~Sex\") + \n  stat_compare_means(method = \"t.test\", label.y = 1.41, label.x = 1.3) + \n  geom_bracket(xmin = 1, xmax = 2, label = '', y.position = 1.4) +\n  theme_pubr() + \n  labs(title='Rufous Males are better at scaring off Female Annas than Male Annas') + \n  scale_fill_manual(values = c('chartreuse1', 'chartreuse4'))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'Date', 'Rufous Males present', 'Timestamp',\n'Sex'. You can override using the `.groups` argument.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n\n```{.r .cell-code}\nbird %>%\n  group_by(Date, Timestamp, Species, .groups='keep') %>%\n  summarize(n=n()) %>%\n  #group_by(Date, Species) %>%\n  #summarize(n=mean(n), .groups = 'keep') %>%\n  ggplot(aes(x=factor(Date), y = n, colour=Species)) + \n  geom_point()+\n  geom_smooth(aes(colour =Species), method='lm', formula='y~poly(x,4)')\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'Date', 'Timestamp', 'Species'. You can\noverride using the `.groups` argument.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-3.png){width=672}\n:::\n\n```{.r .cell-code}\nbird %>%\n  #filter(Species=='Annas') %>%\n  mutate('Rufous Males present' = Date < ymd('2021-07-31')) %>%\n  group_by(Date, `Rufous Males present`, Species, Sex) %>%\n  summarize(n=n()) %>%\n  ggplot(aes(x=`Rufous Males present`, y = n)) +\n  geom_boxplot() +\n  facet_grid(rows =vars(Species), cols = vars(Sex), scales='free')\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'Date', 'Rufous Males present', 'Species'.\nYou can override using the `.groups` argument.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-4.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbird  %>%group_by(Timestamp, Species, Sex) %>% summarize(n=n()) %>% ggplot() +aes(x = Timestamp, y=n, color = Species, fill=Species) + geom_bar(stat='identity') + facet_wrap('~Sex') +scale_color_manual(values=c('chartreuse2', 'chocolate3'))+scale_fill_manual(values=c('chartreuse2', 'chocolate3'))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'Timestamp', 'Species'. You can override\nusing the `.groups` argument.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}